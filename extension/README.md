# Gua Step3反推+魔搭生图 浏览器插件

这是一个基于Step3模型的图片内容分析与魔搭图片生成的Chrome浏览器插件。

## 功能特性

- 🖼️ **图片上传**: 支持拖拽上传或点击选择图片文件
- 🔍 **智能分析**: 使用OpenAI API分析图片内容并生成提示词
- 🎨 **图片生成**: 基于分析结果使用魔搭平台生成新图片
- ⚙️ **设置管理**: 可配置API密钥和生成参数
- 📊 **实时进度**: 显示处理进度和队列状态
- 📝 **操作日志**: 详细的操作记录和错误信息

## 安装说明

### 1. 准备图标文件

由于技术限制，需要手动添加PNG图标文件：

1. 将以下尺寸的PNG图标文件放入 `extension/icons/` 目录：
   - `icon16.png` (16x16像素)
   - `icon48.png` (48x48像素) 
   - `icon128.png` (128x128像素)

2. 可以使用提供的 `icon.svg` 文件转换为PNG格式，或者使用在线工具：
   - 访问 https://convertio.co/svg-png/
   - 上传 `extension/icons/icon.svg`
   - 分别转换为16x16、48x48、128x128尺寸的PNG文件

### 2. 启动后端服务

在安装插件之前，需要先启动本地后端服务：

```bash
# 在项目根目录下
python web_app.py
```

确保服务在 `http://localhost:5000` 上运行。

### 3. 安装插件

1. 打开Chrome浏览器
2. 访问 `chrome://extensions/`
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择 `extension` 文件夹
6. 插件安装完成

## 使用方法

### 1. 配置设置

首次使用需要配置API密钥：

1. 点击插件图标打开弹窗
2. 点击右上角的设置按钮（⚙️）
3. 填入以下信息：
   - **OpenAI API Key**: 用于图片分析
   - **ModelScope Cookie**: 用于图片生成
   - **图片尺寸**: 生成图片的宽度和高度

### 2. 处理图片

1. 拖拽图片到上传区域，或点击选择文件
2. 点击"反推并生成"按钮
3. 等待处理完成
4. 查看生成的图片结果

### 3. 查看结果

- 生成的图片会显示在缩略图区域
- 点击缩略图可在主预览区域查看
- 点击主预览区域可在新标签页中打开图片

## 文件结构

```
extension/
├── manifest.json          # 插件配置文件
├── popup.html            # 弹窗页面
├── scripts/              # JavaScript文件
│   ├── config.js         # 配置文件
│   ├── utils.js          # 工具函数
│   ├── ui.js             # UI管理
│   ├── api.js            # API管理
│   └── popup.js          # 主入口
├── styles/               # 样式文件
│   └── popup.css         # 弹窗样式
├── icons/                # 图标文件
│   ├── icon.svg          # SVG图标（需转换为PNG）
│   ├── icon16.png        # 16x16图标（需添加）
│   ├── icon48.png        # 48x48图标（需添加）
│   └── icon128.png       # 128x128图标（需添加）
└── README.md             # 说明文档
```

## 技术架构

- **前端**: HTML + CSS + JavaScript (ES6+)
- **后端**: Python Flask (需要单独启动)
- **API**: OpenAI GPT-4V + ModelScope
- **存储**: Chrome Extension Storage API

## 注意事项

1. **网络连接**: 需要稳定的网络连接访问OpenAI和ModelScope API
2. **API配额**: 注意API使用配额和费用
3. **文件大小**: 支持最大16MB的图片文件
4. **浏览器兼容**: 仅支持Chrome浏览器（Manifest V3）

## 故障排除

### 常见问题

1. **无法连接到本地服务器**
   - 确保 `web_app.py` 正在运行
   - 检查端口5000是否被占用

2. **API密钥错误**
   - 检查OpenAI API Key是否有效
   - 确认ModelScope Cookie是否正确

3. **图片上传失败**
   - 检查文件格式是否支持
   - 确认文件大小不超过16MB

4. **生成失败**
   - 查看操作日志中的错误信息
   - 检查网络连接状态

### 调试方法

1. 打开Chrome开发者工具
2. 切换到Console标签
3. 查看错误信息和日志
4. 检查Network标签中的API请求

## 更新日志

### v1.0.0
- 初始版本发布
- 支持图片上传和分析
- 支持魔搭平台图片生成
- 完整的UI界面和设置管理

## 许可证

本项目仅供学习和研究使用。